import{E as S,a as T}from"./el-table-column-977f2723.js";import{y as x,x as E,I as O,z as U,A as H,b as p,B as V,J as F,_ as W,K as z,a as A,j as J,r as D,u as K,k as M,l as Q,e as _,s as I,o as G,c as X,d as c,w as y,q as Y,g as Z,N as $,v as ee,t as ae,p as te,h as oe}from"./index-1c837585.js";import{b as se,d as ne,s as le}from"./chukudan-ba15f634.js";import{_ as ie}from"./btn_queren-a649dfc1.js";import{_ as re}from"./btn_shoudong-49ae805b.js";import{_ as ce}from"./btn_tichu-bca5bbb8.js";let L,v;const de=a=>O(a)?a:{message:a};function ue(){({instance:v}=U({setup(){const{state:a,toggle:d}=H();return()=>p(F,V(a,{"onUpdate:show":d}),null)}}))}const pe=()=>({type:"danger",color:void 0,message:"",onClose:void 0,onClick:void 0,onOpened:void 0,duration:3e3,position:void 0,className:"",lockScroll:!1,background:void 0});let me=pe();const fe=()=>{v&&v.toggle(!1)};function B(a){if(x)return v||ue(),a=E({},me,de(a)),v.open(a),clearTimeout(L),a.duration>0&&(L=setTimeout(fe,a.duration)),v}const _e={setup(){z({duration:3e3});const a=A(),d=J();let l=D([]),t=D([{yingjian:0,yijian:0,queshao:0},{yingjian:"",yijian:0,queshao:""}]);const w=()=>history.back(),u=K();M.await("scanner",e=>{B({message:e}),N(e)});let h=0,i=0;const b=()=>{a.push({name:"manualUnqualifiedBarcodes"})};let r="";const j=(e,n,o)=>{r=Y(e)},q=()=>{if(r){let e=l.value.filter(n=>n.barcode!=r.barcode);l.value=e,u.commit("setScandList",l.value),r="",g(e)}else _("请选择要剔除的行！")},P=()=>{if(l.value.length==0){_("没有拣配数据");return}u.state.chukudan;let e=u.state.chukudanListInfo,n=u.state.carInfo,o=u.state.user,s={};s.carNo=n.plateNo,s.carUnit=n.forwardingUnit,s.deliveryNo=n.deliveryNo,s.materialCode=e.materialCode,s.materialId=e.materialDescribeId,s.materialName=e.materialDescribe,s.pickPackage=h,s.pickPerson=(o==null?void 0:o.userId)||"",s.pickWeight=i,s.receiveUnit=e.receiveUnit,s.remark=e.remark,s.sendPlanNo=e.billNo,s.type=e.type,s.unit=e.unit,s.warehouseCode=n.warehouseCode,s.warehouseName=n.warehouseName;let C=[];l.value.forEach(m=>{let f={};f.barcode=m.barcode,f.batchNo=m.batchNo,f.blocks=m.blocks,f.carNo=n.plateNo,f.code=m.code,f.unit=m.unit,f.weight=m.weight,C.push(f)});let R=e.planNo;I(),le({pickBill:s,pickBillDetailList:C,planNo:R}).then(m=>{(m.data.state=!0)?(l.value=[],u.commit("setScandList",l.value),Z({message:"拣配成功!",type:"success",className:"toast",overlay:!0}),setTimeout(()=>{a.push({name:"chukudanQuery"})},2e3)):_(m.data.message)})},g=e=>{let n=u.state.chukudanListInfo;t.value[0].yingjian=n.planNum,t.value[0].queshao=n.planNum,h=0,i=0,e.forEach(o=>{h+=o.blocks,i+=o.weight}),t.value[0].yijian=i,t.value[1].yijian=h,i>0&&(t.value[0].queshao=(t.value[0].yingjian-i).toFixed(2)),t.value[0].queshao<0&&_("请求数量过多！")};Q(()=>{let n=d.query.barcode,o=u.state.scandList||[];l.value=o,g(o),B({message:n}),N(n)});const N=e=>{if(e){if(!se(e.trim())){_("条形码不符合规范");return}for(let o=0;o<l.value.length;o++)if(l.value[o].barcode==e){_("该批次已经选择，请勿重复选择！");return}I("加载中"),ne(e).then(o=>{o.data.value===!0?_(o.data.message):(l.value.push(o.data.value),u.commit("setScandList",l.value),g(l.value))})}};return{onClickLeft:w,tableData1:l,tableData2:t,onHandle:b,onConfirm:P,selectRow:j,onDelete:q}}},k=a=>(te("data-v-e83df31a"),a=a(),oe(),a),he={class:"container"},ve={class:"btn-area"},ke=k(()=>c("img",{src:ie,alt:""},null,-1)),be=k(()=>c("div",null,"确认",-1)),ge=[ke,be],ye=k(()=>c("img",{src:re,alt:"",type:"primary"},null,-1)),we=k(()=>c("div",null,"手动",-1)),Ne=[ye,we],Ce=k(()=>c("img",{src:ce,alt:"",type:"primary"},null,-1)),De=k(()=>c("div",null,"剔除",-1)),Ie=[Ce,De];function Le(a,d,l,t,w,u){const h=$,i=T,b=S;return G(),X("main",null,[p(h,{title:"拣配",class:"page-nav-bar","left-arrow":"",onClickLeft:t.onClickLeft},null,8,["onClickLeft"]),c("div",he,[p(b,{data:t.tableData1,border:"",id:"data-area1",onRowClick:t.selectRow},{default:y(()=>[p(i,{label:"日期"},{default:y(r=>[ee(ae(r.row.proDate.substr(0,10)),1)]),_:1}),p(i,{prop:"barcode",label:"条形码"}),p(i,{prop:"weight",label:"重量"})]),_:1},8,["data","onRowClick"]),p(b,{data:t.tableData2,border:"",id:"data-area2"},{default:y(()=>[p(i,{prop:"yingjian",label:"应拣"}),p(i,{prop:"yijian",label:"已拣"}),p(i,{prop:"queshao",label:"缺少"})]),_:1},8,["data"]),c("div",ve,[c("div",{onClick:d[0]||(d[0]=(...r)=>t.onConfirm&&t.onConfirm(...r))},ge),c("div",{onClick:d[1]||(d[1]=(...r)=>t.onHandle&&t.onHandle(...r))},Ne),c("div",{onClick:d[2]||(d[2]=(...r)=>t.onDelete&&t.onDelete(...r))},Ie)])])])}const Te=W(_e,[["render",Le],["__scopeId","data-v-e83df31a"]]);export{Te as default};
