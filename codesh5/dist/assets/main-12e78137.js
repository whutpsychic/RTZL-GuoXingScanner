import{E as I,a as q}from"./el-table-column-2920fad0.js";import{_ as B,a as j,k as R,r as w,u as S,m as x,e as b,s as N,o as E,c as P,b as u,d as n,w as g,q as T,g as U,N as H,v as V,t as F,p as W,i as M}from"./index-a42274b6.js";import{b as z,d as A,s as G}from"./chukudan-b231e240.js";import{_ as J}from"./btn_queren-a649dfc1.js";import{_ as K}from"./btn_shoudong-49ae805b.js";import{_ as O}from"./btn_tichu-bca5bbb8.js";const Q={setup(){const p=j(),_=R();let i=w([]),o=w([{yingjian:0,yijian:0,queshao:0},{yingjian:"",yijian:0,queshao:""}]);const y=()=>history.back(),c=S();let f=0,s=0;const v=()=>{p.push({name:"manualUnqualifiedBarcodes"})};let l="";const C=(t,e,a)=>{l=T(t)},L=()=>{if(l){let t=i.value.filter(e=>e.barcode!=l.barcode);i.value=t,c.commit("setScandList",i.value),l="",k(t)}else b("请选择要剔除的行！")},D=()=>{if(i.value.length==0){b("没有拣配数据");return}c.state.chukudan;let t=c.state.chukudanListInfo,e=c.state.carInfo;c.state.userInfo;let a={};a.carNo=e.plateNo,a.carUnit=e.forwardingUnit,a.deliveryNo=e.deliveryNo,a.materialCode=t.materialCode,a.materialId=t.materialDescribeId,a.materialName=t.materialDescribe,a.pickPackage=f,a.pickWeight=s,a.receiveUnit=t.receiveUnit,a.remark=t.remark,a.sendPlanNo=t.billNo,a.type=t.type,a.unit=t.unit,a.warehouseCode=e.warehouseCode,a.warehouseName=e.warehouseName;let r=[];i.value.forEach(d=>{let m={};m.barcode=d.barcode,m.batchNo=d.batchNo,m.blocks=d.blocks,m.carNo=e.plateNo,m.code=d.code,m.unit=d.unit,m.weight=d.weight,r.push(m)}),N(),G({pickBill:a,pickBillDetailList:r}).then(d=>{(d.data.state=!0)?(i.value=[],c.commit("setScandList",i.value),U({message:"拣配成功!",type:"success",className:"toast",overlay:!0})):b(d.data.message)})},k=t=>{let e=c.state.chukudanListInfo;o.value[0].yingjian=e.planNum,o.value[0].queshao=e.planNum,f=0,s=0,t.forEach(a=>{f+=a.blocks,s+=a.weight}),o.value[0].yijian=s,o.value[1].yijian=f,s>0&&(o.value[0].queshao=(o.value[0].yingjian-s/1e3).toFixed(4)),o.value[0].queshao<0&&b("请求数量过多！")};return x(()=>{let t=_.query,e=c.state.scandList||[];if(i.value=e,k(e),t.barcode){if(!z(t.barcode.trim())){b("条形码不符合规范");return}for(let r=0;r<e.length;r++)if(e[r].barcode==t.barcode){b("该批次已经选择，请勿重复选择！");return}N("加载中"),A(t.barcode).then(r=>{r.data.value===!0?b(r.data.message):(e.push(r.data.value),c.commit("setScandList",e),i.value=e,k(e))})}}),{onClickLeft:y,tableData1:i,tableData2:o,onHandle:v,onConfirm:D,selectRow:C,onDelete:L}}},h=p=>(W("data-v-b30cbbb7"),p=p(),M(),p),X={class:"container"},Y={class:"btn-area"},Z=h(()=>n("img",{src:J,alt:""},null,-1)),$=h(()=>n("div",null,"确认",-1)),ee=[Z,$],ae=h(()=>n("img",{src:K,alt:"",type:"primary"},null,-1)),te=h(()=>n("div",null,"手动",-1)),oe=[ae,te],se=h(()=>n("img",{src:O,alt:"",type:"primary"},null,-1)),le=h(()=>n("div",null,"剔除",-1)),ie=[se,le];function ne(p,_,i,o,y,c){const f=H,s=q,v=I;return E(),P("main",null,[u(f,{title:"拣配",class:"page-nav-bar","left-arrow":"",onClickLeft:o.onClickLeft},null,8,["onClickLeft"]),n("div",X,[u(v,{data:o.tableData1,border:"",id:"data-area1",onRowClick:o.selectRow},{default:g(()=>[u(s,{label:"日期"},{default:g(l=>[V(F(l.row.proDate.substr(0,10)),1)]),_:1}),u(s,{prop:"code",label:"条形码"}),u(s,{prop:"weight",label:"重量"})]),_:1},8,["data","onRowClick"]),u(v,{data:o.tableData2,border:"",id:"data-area2"},{default:g(()=>[u(s,{prop:"yingjian",label:"应拣"}),u(s,{prop:"yijian",label:"已拣"}),u(s,{prop:"queshao",label:"缺少"})]),_:1},8,["data"]),n("div",Y,[n("div",{onClick:_[0]||(_[0]=(...l)=>o.onConfirm&&o.onConfirm(...l))},ee),n("div",{onClick:_[1]||(_[1]=(...l)=>o.onHandle&&o.onHandle(...l))},oe),n("div",{onClick:_[2]||(_[2]=(...l)=>o.onDelete&&o.onDelete(...l))},ie)])])])}const be=B(Q,[["render",ne],["__scopeId","data-v-b30cbbb7"]]);export{be as default};
