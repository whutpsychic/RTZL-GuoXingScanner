import{E as I,a as q}from"./el-table-column-9dc30bdf.js";import{_ as B,a as j,k as x,r as y,u as R,m as S,e as p,s as N,o as E,c as P,b as u,d as n,w as g,q as T,g as U,N as H,v as V,t as F,p as W,i as M}from"./index-ba1bf418.js";import{b as z,d as A,s as G}from"./chukudan-6674f75b.js";import{_ as J}from"./btn_queren-a649dfc1.js";import{_ as K}from"./btn_shoudong-49ae805b.js";import{_ as O}from"./btn_tichu-bca5bbb8.js";const Q={setup(){const h=j(),_=x();let i=y([]),o=y([{yingjian:0,yijian:0,queshao:0},{yingjian:"",yijian:0,queshao:""}]);const w=()=>history.back(),c=R();let f=0,s=0;const b=()=>{h.push({name:"manualUnqualifiedBarcodes"})};let l="";const C=(t,a,e)=>{l=T(t)},L=()=>{if(l){let t=i.value.filter(a=>a.barcode!=l.barcode);i.value=t,c.commit("setScandList",i.value),l="",k(t)}else p("请选择要剔除的行！")},D=()=>{if(i.value.length==0){p("没有拣配数据");return}c.state.chukudan;let t=c.state.chukudanListInfo,a=c.state.carInfo;c.state.userInfo;let e={};e.carNo=a.plateNo,e.carUnit=a.forwardingUnit,e.deliveryNo=a.deliveryNo,e.materialCode=t.materialCode,e.materialId=t.materialDescribeId,e.materialName=t.materialDescribe,e.pickPackage=f,e.pickWeight=s,e.receiveUnit=t.receiveUnit,e.remark=t.remark,e.sendPlanNo=t.billNo,e.type=t.type,e.unit=t.unit,e.warehouseCode=a.warehouseCode,e.warehouseName=a.warehouseName;let r=[];i.value.forEach(d=>{let m={};m.barcode=d.barcode,m.batchNo=d.batchNo,m.blocks=d.blocks,m.carNo=a.plateNo,m.code=d.code,m.unit=d.unit,m.weight=d.weight,r.push(m)}),N(),G({pickBill:e,pickBillDetailList:r}).then(d=>{(d.data.state=!0)?(i.value=[],c.commit("setScandList",i.value),U({message:"拣配成功!",type:"success",className:"toast",overlay:!0})):p(d.data.message)})},k=t=>{let a=c.state.chukudanListInfo;o.value[0].yingjian=a.planNum,o.value[0].queshao=a.planNum,f=0,s=0,t.forEach(e=>{f+=e.blocks,s+=e.weight}),o.value[0].yijian=s,o.value[1].yijian=f,s>0&&(o.value[0].queshao=(o.value[0].yingjian-s/1e3).toFixed(4)),o.value[0].queshao<0&&p("请求数量过多！")};return S(()=>{let t=_.query,a=c.state.scandList||[];if(i.value=a,k(a),t.barcode){if(!z(t.barcode.trim())){p("条形码不符合规范");return}for(let r=0;r<a.length;r++)if(a[r].barcode==t.barcode){p("该批次已经选择，请勿重复选择！");return}N("加载中"),A(t.barcode).then(r=>{r.data.value===!0?p(r.data.message):(a.push(r.data.value),c.commit("setScandList",a),i.value=a,k(a))})}}),{onClickLeft:w,tableData1:i,tableData2:o,onHandle:b,onConfirm:D,selectRow:C,onDelete:L}}},v=h=>(W("data-v-863acd2c"),h=h(),M(),h),X={class:"container"},Y={class:"btn-area"},Z=v(()=>n("img",{src:J,alt:""},null,-1)),$=v(()=>n("div",null,"确认",-1)),aa=[Z,$],ea=v(()=>n("img",{src:K,alt:"",type:"primary"},null,-1)),ta=v(()=>n("div",null,"手动",-1)),oa=[ea,ta],sa=v(()=>n("img",{src:O,alt:"",type:"primary"},null,-1)),la=v(()=>n("div",null,"剔除",-1)),ia=[sa,la];function na(h,_,i,o,w,c){const f=H,s=q,b=I;return E(),P("main",null,[u(f,{title:"拣配",class:"page-nav-bar","left-arrow":"",onClickLeft:o.onClickLeft},null,8,["onClickLeft"]),n("div",X,[u(b,{data:o.tableData1,border:"",id:"data-area1",onRowClick:o.selectRow},{default:g(()=>[u(s,{label:"日期",width:"150px"},{default:g(l=>[V(F(l.row.proDate.substr(0,10)),1)]),_:1}),u(s,{prop:"code",label:"条形码",width:"210px"}),u(s,{prop:"weight",label:"重量",width:"110px"})]),_:1},8,["data","onRowClick"]),u(b,{data:o.tableData2,border:"",id:"data-area2"},{default:g(()=>[u(s,{prop:"yingjian",label:"应拣"}),u(s,{prop:"yijian",label:"已拣"}),u(s,{prop:"queshao",label:"缺少"})]),_:1},8,["data"]),n("div",Y,[n("div",{onClick:_[0]||(_[0]=(...l)=>o.onConfirm&&o.onConfirm(...l))},aa),n("div",{onClick:_[1]||(_[1]=(...l)=>o.onHandle&&o.onHandle(...l))},oa),n("div",{onClick:_[2]||(_[2]=(...l)=>o.onDelete&&o.onDelete(...l))},ia)])])])}const pa=B(Q,[["render",na],["__scopeId","data-v-863acd2c"]]);export{pa as default};
