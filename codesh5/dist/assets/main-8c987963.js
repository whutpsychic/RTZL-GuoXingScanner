import{E as B,a as j}from"./el-table-column-94729eb9.js";import{_ as R,I as P,a as S,j as T,r as C,u as x,k as E,l as U,e as f,s as I,o as H,c as V,b as u,d as r,w as y,q as F,g as W,N as M,v as O,t as Q,p as z,h as A}from"./index-9ccdd58d.js";import{b as G,d as J,s as K}from"./chukudan-4f0329c7.js";import{_ as X}from"./btn_queren-a649dfc1.js";import{_ as Y}from"./btn_shoudong-49ae805b.js";import{_ as Z}from"./btn_tichu-bca5bbb8.js";const $={setup(){P({duration:3e3});const p=S(),_=T();let s=C([]),a=C([{yingjian:0,yijian:0,queshao:0},{yingjian:"",yijian:0,queshao:""}]);const g=()=>history.back(),c=x();E.await("scanner",e=>{w(e)});let h=0,n=0;const k=()=>{p.push({name:"manualUnqualifiedBarcodes"})};let i="";const D=(e,l,o)=>{i=F(e)},L=()=>{if(i){let e=s.value.filter(l=>l.barcode!=i.barcode);s.value=e,c.commit("setScandList",s.value),i="",b(e)}else f("请选择要剔除的行！")},q=()=>{if(s.value.length==0){f("没有拣配数据");return}c.state.chukudan;let e=c.state.chukudanListInfo,l=c.state.carInfo,o=c.state.userInfo,t={};t.carNo=l.plateNo,t.carUnit=l.forwardingUnit,t.deliveryNo=l.deliveryNo,t.materialCode=e.materialCode,t.materialId=e.materialDescribeId,t.materialName=e.materialDescribe,t.pickPackage=h,t.pickPerson=o.userId,t.pickWeight=n,t.receiveUnit=e.receiveUnit,t.remark=e.remark,t.sendPlanNo=e.billNo,t.type=e.type,t.unit=e.unit,t.warehouseCode=l.warehouseCode,t.warehouseName=l.warehouseName;let N=[];s.value.forEach(d=>{let m={};m.barcode=d.barcode,m.batchNo=d.batchNo,m.blocks=d.blocks,m.carNo=l.plateNo,m.code=d.code,m.unit=d.unit,m.weight=d.weight,N.push(m)}),I(),K({pickBill:t,pickBillDetailList:N}).then(d=>{(d.data.state=!0)?(s.value=[],c.commit("setScandList",s.value),W({message:"拣配成功!",type:"success",className:"toast",overlay:!0}),setTimeout(()=>{p.push({name:"chukudanQuery"})},2e3)):f(d.data.message)})},b=e=>{let l=c.state.chukudanListInfo;a.value[0].yingjian=l.planNum,a.value[0].queshao=l.planNum,h=0,n=0,e.forEach(o=>{h+=o.blocks,n+=o.weight}),a.value[0].yijian=n,a.value[1].yijian=h,n>0&&(a.value[0].queshao=(a.value[0].yingjian-n).toFixed(2)),a.value[0].queshao<0&&f("请求数量过多！")};U(()=>{let l=_.query.barcode,o=c.state.scandList||[];s.value=o,b(o),w(l)});const w=e=>{if(e){if(!G(e.trim())){f("条形码不符合规范");return}for(let o=0;o<s.value.length;o++)if(s.value[o].barcode==e){f("该批次已经选择，请勿重复选择！");return}I("加载中"),J(e).then(o=>{o.data.value===!0?f(o.data.message):(s.value.push(o.data.value),c.commit("setScandList",s.value),b(s.value))})}};return{onClickLeft:g,tableData1:s,tableData2:a,onHandle:k,onConfirm:q,selectRow:D,onDelete:L}}},v=p=>(z("data-v-ca64045f"),p=p(),A(),p),ee={class:"container"},ae={class:"btn-area"},te=v(()=>r("img",{src:X,alt:""},null,-1)),oe=v(()=>r("div",null,"确认",-1)),se=[te,oe],le=v(()=>r("img",{src:Y,alt:"",type:"primary"},null,-1)),ne=v(()=>r("div",null,"手动",-1)),ie=[le,ne],re=v(()=>r("img",{src:Z,alt:"",type:"primary"},null,-1)),ce=v(()=>r("div",null,"剔除",-1)),de=[re,ce];function ue(p,_,s,a,g,c){const h=M,n=j,k=B;return H(),V("main",null,[u(h,{title:"拣配",class:"page-nav-bar","left-arrow":"",onClickLeft:a.onClickLeft},null,8,["onClickLeft"]),r("div",ee,[u(k,{data:a.tableData1,border:"",id:"data-area1",onRowClick:a.selectRow},{default:y(()=>[u(n,{label:"日期"},{default:y(i=>[O(Q(i.row.proDate.substr(0,10)),1)]),_:1}),u(n,{prop:"barcode",label:"条形码"}),u(n,{prop:"weight",label:"重量"})]),_:1},8,["data","onRowClick"]),u(k,{data:a.tableData2,border:"",id:"data-area2"},{default:y(()=>[u(n,{prop:"yingjian",label:"应拣"}),u(n,{prop:"yijian",label:"已拣"}),u(n,{prop:"queshao",label:"缺少"})]),_:1},8,["data"]),r("div",ae,[r("div",{onClick:_[0]||(_[0]=(...i)=>a.onConfirm&&a.onConfirm(...i))},se),r("div",{onClick:_[1]||(_[1]=(...i)=>a.onHandle&&a.onHandle(...i))},ie),r("div",{onClick:_[2]||(_[2]=(...i)=>a.onDelete&&a.onDelete(...i))},de)])])])}const ke=R($,[["render",ue],["__scopeId","data-v-ca64045f"]]);export{ke as default};
