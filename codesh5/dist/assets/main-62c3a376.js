import{E as j,a as R}from"./el-table-column-60fcb985.js";import{_ as P,I as S,a as T,k as x,r as L,u as E,l as U,g as C,m as H,e as f,s as I,o as V,c as F,b as u,d as c,w as y,q as W,N as M,v as O,t as Q,p as z,i as A}from"./index-54451b7a.js";import{b as G,d as J,s as K}from"./chukudan-21cc787b.js";import{_ as X}from"./btn_queren-a649dfc1.js";import{_ as Y}from"./btn_shoudong-49ae805b.js";import{_ as Z}from"./btn_tichu-bca5bbb8.js";const $={setup(){S({duration:3e3});const p=T(),m=x();let l=L([]),a=L([{yingjian:0,yijian:0,queshao:0},{yingjian:"",yijian:0,queshao:""}]);const g=()=>history.back(),r=E();U.await("scanner",e=>{C({message:e,type:"success",className:"toast",overlay:!0}),w(e)});let h=0,n=0;const b=()=>{p.push({name:"manualUnqualifiedBarcodes"})};let i="";const D=(e,s,o)=>{i=W(e)},q=()=>{if(i){let e=l.value.filter(s=>s.barcode!=i.barcode);l.value=e,r.commit("setScandList",l.value),i="",k(e)}else f("请选择要剔除的行！")},B=()=>{if(l.value.length==0){f("没有拣配数据");return}r.state.chukudan;let e=r.state.chukudanListInfo,s=r.state.carInfo,o=r.state.userInfo,t={};t.carNo=s.plateNo,t.carUnit=s.forwardingUnit,t.deliveryNo=s.deliveryNo,t.materialCode=e.materialCode,t.materialId=e.materialDescribeId,t.materialName=e.materialDescribe,t.pickPackage=h,t.pickPerson=o.userId,t.pickWeight=n,t.receiveUnit=e.receiveUnit,t.remark=e.remark,t.sendPlanNo=e.billNo,t.type=e.type,t.unit=e.unit,t.warehouseCode=s.warehouseCode,t.warehouseName=s.warehouseName;let N=[];l.value.forEach(d=>{let _={};_.barcode=d.barcode,_.batchNo=d.batchNo,_.blocks=d.blocks,_.carNo=s.plateNo,_.code=d.code,_.unit=d.unit,_.weight=d.weight,N.push(_)}),I(),K({pickBill:t,pickBillDetailList:N}).then(d=>{(d.data.state=!0)?(l.value=[],r.commit("setScandList",l.value),C({message:"拣配成功!",type:"success",className:"toast",overlay:!0}),setTimeout(()=>{p.push({name:"chukudanQuery"})},2e3)):f(d.data.message)})},k=e=>{let s=r.state.chukudanListInfo;a.value[0].yingjian=s.planNum,a.value[0].queshao=s.planNum,h=0,n=0,e.forEach(o=>{h+=o.blocks,n+=o.weight}),a.value[0].yijian=n,a.value[1].yijian=h,n>0&&(a.value[0].queshao=(a.value[0].yingjian-n/1e3).toFixed(4)),a.value[0].queshao<0&&f("请求数量过多！")};H(()=>{let s=m.query.barcode,o=r.state.scandList||[];l.value=o,k(o),w(s)});const w=e=>{if(e){if(!G(e.trim())){f("条形码不符合规范");return}for(let o=0;o<scandList.length;o++)if(scandList[o].barcode==e){f("该批次已经选择，请勿重复选择！");return}I("加载中"),J(e).then(o=>{o.data.value===!0?f(o.data.message):(scandList.push(o.data.value),r.commit("setScandList",scandList),l.value=scandList,k(scandList))})}};return{onClickLeft:g,tableData1:l,tableData2:a,onHandle:b,onConfirm:B,selectRow:D,onDelete:q}}},v=p=>(z("data-v-e22462bd"),p=p(),A(),p),ee={class:"container"},ae={class:"btn-area"},te=v(()=>c("img",{src:X,alt:""},null,-1)),oe=v(()=>c("div",null,"确认",-1)),se=[te,oe],ne=v(()=>c("img",{src:Y,alt:"",type:"primary"},null,-1)),ie=v(()=>c("div",null,"手动",-1)),le=[ne,ie],ce=v(()=>c("img",{src:Z,alt:"",type:"primary"},null,-1)),re=v(()=>c("div",null,"剔除",-1)),de=[ce,re];function ue(p,m,l,a,g,r){const h=M,n=R,b=j;return V(),F("main",null,[u(h,{title:"拣配",class:"page-nav-bar","left-arrow":"",onClickLeft:a.onClickLeft},null,8,["onClickLeft"]),c("div",ee,[u(b,{data:a.tableData1,border:"",id:"data-area1",onRowClick:a.selectRow},{default:y(()=>[u(n,{label:"日期"},{default:y(i=>[O(Q(i.row.proDate.substr(0,10)),1)]),_:1}),u(n,{prop:"barcode",label:"条形码"}),u(n,{prop:"weight",label:"重量"})]),_:1},8,["data","onRowClick"]),u(b,{data:a.tableData2,border:"",id:"data-area2"},{default:y(()=>[u(n,{prop:"yingjian",label:"应拣"}),u(n,{prop:"yijian",label:"已拣"}),u(n,{prop:"queshao",label:"缺少"})]),_:1},8,["data"]),c("div",ae,[c("div",{onClick:m[0]||(m[0]=(...i)=>a.onConfirm&&a.onConfirm(...i))},se),c("div",{onClick:m[1]||(m[1]=(...i)=>a.onHandle&&a.onHandle(...i))},le),c("div",{onClick:m[2]||(m[2]=(...i)=>a.onDelete&&a.onDelete(...i))},de)])])])}const be=P($,[["render",ue],["__scopeId","data-v-e22462bd"]]);export{be as default};
